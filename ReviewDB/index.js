(function(u,o,t,c,y,l,d,R,p,m){"use strict";const v="915703782174752809",f="https://manti.vendicated.dev";async function w(e){return await(await l.safeFetch(f+"/getUserReviews?discordid="+e,{})).json()}const g=t.stylesheet.createThemedStyleSheet({avatar:{height:36,width:36,borderRadius:18}});function E(e){let{review:n}=e;return React.createElement(d.Forms.FormRow,{label:n.username,subLabel:n.comment,leading:React.createElement(t.ReactNative.Image,{style:g.avatar,source:{uri:n.profile_photo}})})}const b=c.findByDisplayName("UserProfileSection");function A(e){let{userId:n}=e;const[a,s]=t.React.useState([]);return t.React.useEffect(function(){w(n).then(function(r){return s(r)})},[]),t.React.createElement(d.ErrorBoundary,null,t.React.createElement(b,{title:"Reviews",showContainer:!0},a.map(function(r){return t.React.createElement(E,{review:r})})))}const I=c.find(function(e){return e.type?.name==="UserProfile"}),P=function(){return y.after("type",I,function(e,n){const a=l.findInReactTree(n,function(r){return r?.props?.children.find(function(h){return typeof h?.props?.displayProfile?.userId=="string"})&&r?.type?.displayName==="View"&&Array?.isArray(r?.props?.style)})?.props?.children,s=e[0].userId;a?.push(t.React.createElement(A,{userId:s}))})},{pushModal:S,popModal:B}=c.findByProps("pushModal"),T=c.findByDisplayName("OAuth2AuthorizeModal");function U(){return S({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:T,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:v,redirectUri:f+"/URauth",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:n}=e;try{const a=new URL(n);a.searchParams.append("returnType","json"),a.searchParams.append("clientMod","vendetta");const s=await l.safeFetch(a.toString(),{headers:{accept:"application/json"}}),{token:r,status:h}=await s.json();if(h===0)o.storage.authToken=r;else throw new Error("Status returned by backend was not OK")}catch(a){m.logger.error("Authorization failed!",a)}},dismissOAuthModal:function(){return B("oauth2-authorize")}},closable:!0}})}const{FormSection:k,FormRow:i}=d.Forms;function D(){return R.useProxy(o.storage),React.createElement(t.ReactNative.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(k,{title:"Authentication",titleStyleType:"no_border"},React.createElement(i,{label:"Authenticate with ReviewDB",leading:React.createElement(i.Icon,{source:p.getAssetIDByName("copy")}),trailing:i.Arrow,onPress:U}),React.createElement(i,{label:"Log out of ReviewDB",subLabel:"Note that this does not remove ReviewDB from your Authorized Apps page in Discord.",leading:React.createElement(i.Icon,{source:p.getAssetIDByName("ic_logout_24px")}),disabled:o.storage.authToken.length===0,onPress:function(){return o.storage.authToken=""}})))}o.storage.authToken??="";const N=[P()],F=function(){return N.forEach(function(e){return e()})};return u.onUnload=F,u.settings=D,u})({},vendetta.plugin,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta);
