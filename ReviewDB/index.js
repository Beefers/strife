(function(y,i,e,c,v,h,f,w,m,g,l,E){"use strict";const I="915703782174752809",p="https://manti.vendicated.dev";async function b(t){return await(await h.safeFetch(p+"/getUserReviews?discordid="+t,{})).json()}async function T(t,a){return await(await h.safeFetch(p+"/addUserReview",{method:"POST",body:JSON.stringify({userid:t,comment:a,token:i.storage.authToken}),headers:{"content-type":"application/json",accept:"text/plain"}})).text()}const B=e.stylesheet.createThemedStyleSheet({avatar:{height:36,width:36,borderRadius:18}}),{FormRow:S,FormLabel:A,FormSubLabel:N}=f.Forms,{colors:P,meta:k}=c.findByProps("colors","meta"),x=c.findByProps("useThemeContext").useThemeContext;function D(t){let{review:a}=t;const n=x(),r=k.resolveSemanticColor(n.theme,P.TEXT_NORMAL);return React.createElement(S,{label:React.createElement(A,{text:a.username,style:{color:r}}),subLabel:React.createElement(N,{text:a.comment,style:{color:r}}),leading:React.createElement(e.ReactNative.Image,{style:B.avatar,source:{uri:a.profile_photo}})})}const R=e.stylesheet.createThemedStyleSheet({container:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",marginBottom:4,marginHorizontal:8},textInput:{flex:1,paddingTop:0,paddingHorizontal:0},sendButton:{flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:m.rawColors.BRAND_500,height:40,width:40,borderRadius:20,marginLeft:4}});function C(t){let{userId:a,refetch:n}=t;w.useProxy(i.storage);const[r,o]=e.React.useState(""),s=!i.storage.authToken,K=!i.storage.authToken||r.length===0;return e.React.createElement(e.ReactNative.View,{style:R.container},e.React.createElement(f.Forms.FormInput,{style:R.textInput,editable:!s,placeholder:s?"You must be authorised to add a review.":"Tap to add a review",showBorder:!1,value:r,onChange:function(d){return o(d)}}),e.React.createElement(e.ReactNative.Pressable,{style:{...R.sendButton,opacity:K?.25:1},onPress:function(){console.log("pressed"),T(a,r).then(function(d){o(""),n(),g.showToast(d,l.getAssetIDByName("Check"))}).catch(function(d){return g.showToast(d,l.getAssetIDByName("Small"))})}},e.React.createElement(e.ReactNative.Image,{style:{tintColor:"#fff"},source:l.getAssetIDByName("ic_send")})))}const F=c.findByDisplayName("UserProfileSection");function U(t){let{userId:a}=t;const[n,r]=e.React.useState([]),o=function(){b(a).then(function(s){return r(s)})};return e.React.useEffect(o,[]),e.React.createElement(f.ErrorBoundary,null,e.React.createElement(F,{title:"Reviews",showContainer:!0},e.React.createElement(e.ReactNative.View,{style:{flex:1}},n.map(function(s){return e.React.createElement(D,{review:s})})),e.React.createElement(C,{userId:a,refetch:o})))}const L=c.find(function(t){return t.type?.name==="UserProfile"}),_=function(){return v.after("type",L,function(t,a){const n=h.findInReactTree(a,function(o){return o?.props?.children.find(function(s){return typeof s?.props?.displayProfile?.userId=="string"})&&o?.type?.displayName==="View"&&Array?.isArray(o?.props?.style)})?.props?.children,r=t[0].userId;n?.push(e.React.createElement(U,{userId:r}))})},{pushModal:z,popModal:M}=c.findByProps("pushModal"),j=c.findByDisplayName("OAuth2AuthorizeModal");function $(){return z({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:j,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:I,redirectUri:p+"/URauth",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){let{location:a}=t;try{const n=new URL(a);n.searchParams.append("returnType","json"),n.searchParams.append("clientMod","vendetta");const r=await h.safeFetch(n.toString(),{headers:{accept:"application/json"}}),{token:o,status:s}=await r.json();if(s===0)i.storage.authToken=o;else throw new Error("Status returned by backend was not OK")}catch(n){E.logger.error("Authorization failed!",n)}},dismissOAuthModal:function(){return M("oauth2-authorize")}},closable:!0}})}const{FormSection:O,FormRow:u}=f.Forms;function V(){return w.useProxy(i.storage),React.createElement(e.ReactNative.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(O,{title:"Authentication",titleStyleType:"no_border"},React.createElement(u,{label:"Authenticate with ReviewDB",leading:React.createElement(u.Icon,{source:l.getAssetIDByName("copy")}),trailing:u.Arrow,onPress:$}),React.createElement(u,{label:"Log out of ReviewDB",subLabel:"Note that this does not remove ReviewDB from your Authorized Apps page in Discord.",leading:React.createElement(u.Icon,{source:l.getAssetIDByName("ic_logout_24px")}),disabled:i.storage.authToken.length===0,onPress:function(){return i.storage.authToken=""}})))}i.storage.authToken??="";const H=[_()],J=function(){return H.forEach(function(t){return t()})};return y.onUnload=J,y.settings=V,y})({},vendetta.plugin,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.ui.components,vendetta.storage,vendetta.ui,vendetta.ui.toasts,vendetta.ui.assets,vendetta);
